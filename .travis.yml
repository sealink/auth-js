language: node_js
node_js:
  - "10"
  - "12"
after_success: npm coverage
jobs:
  include:
    - stage: Produce Coverage
      node_js: 12
      script:
        jest --coverage && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js
        && rm -rf ./coverage
    - stage: npm release
      node_js: 12
      script: echo "Deploying to npm ..."
      deploy:
        provider: npm
        email: support@travellink.com.au
        skip_cleanup: true
        node: "12.0"
        api_key:
          secure: cq2mtcYZRFCEYS8V1xSGcnIoJvC6ENLCQYttL/y3mxq2nB1qWVewEsTSu2UdBXxUjiB7pbM483pG619ub9GmOh4isUVPqnqsHicDQh2wZilITkDoEcmiURzsPHlR6b9eOqJygeuTevUx3MrMe2oxJRCy08TRl5MwXI3H3zgtkFKUonsrvdXrkU+VxmE7iwRpv4O0XWE18WoGySXUMo8RzaOdlQP2L6VkvM2pQarpMXzuBrXRTxvFf/7Vu9ng6CKuOfRq7LhrrxFmmanPekmicIXVin8eLZVD4Kc6nGB8JdJI1yqCsmfjkDlH6qcCFbtJKgOreQ0tDaKIKrw8PRPrGiHri5YI7mUzzrDOnyJTe6u8pd6mtwZAaShKJL00KYIoO8LROeBibDFTRw7jVBwBt+avl/4aBwwZ1k1/k6ASirwRVqE+AA0AXlyetnTlf8/Ub7gW4FC5yxPERZ3zRdIkELjaemLniuQZd0zhEKJ6N/rOAbkd8OjTZO1y7zP8fn1Ed/DPyxrA5A6771yhrxBNkc0TFgDTKbtN90vtpGEfmvQY8+3VEJbEx0gQd9wBJB2x6xXxFp6WI6TyaP3xZVcjz8Im7t/T2tTnxjr6+1M+1OHoB6r6vf1MsnQvMUNeAiDmugRvfpHEmpQY/1nT2iYqCwW4VlidGLbuRaZ8QpU4cu8=
        on:
          all_branches: true
          tags: true
